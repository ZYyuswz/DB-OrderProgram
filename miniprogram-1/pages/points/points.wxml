<!--points.wxml-->
<view class="container">
  <!-- 积分余额卡片 -->
  <view class="balance-card">
    <view class="balance-header">
      <text class="balance-title">积分余额</text>
      <text class="balance-number">{{pointsBalance}}</text>
    </view>
    <view class="balance-desc">
      <text>累计获得积分，可用于兑换优惠券和礼品</text>
    </view>
  </view>

  <!-- 积分记录列表 -->
  <view class="records-section">
    <view class="section-title">
      <text>积分记录</text>
    </view>
    
    <view class="records-list" wx:if="{{pointsRecords.length > 0}}">
      <view 
        class="record-item" 
        wx:for="{{pointsRecords}}" 
        wx:key="recordId"
        data-orderid="{{item.orderId}}"
        bindtap="goToOrderDetail"
      >
        <view class="record-header">
          <view class="record-type">
            <text class="type-icon">{{item.typeInfo.icon}}</text>
            <text class="type-text {{item.typeInfo.class}}">{{item.typeInfo.text}}</text>
          </view>
          <view class="record-points {{item.pointsChange > 0 ? 'positive' : 'negative'}}">
            <text wx:if="{{item.pointsChange > 0}}">+{{item.pointsChange}}</text>
            <text wx:else>{{item.pointsChange}}</text>
          </view>
        </view>
        
        <view class="record-content">
          <view class="record-desc">{{item.description}}</view>
          
          <view class="record-details" wx:if="{{item.orderAmount > 0}}">
            <text class="detail-item">订单金额: ¥{{item.orderAmount}}</text>
            <text class="detail-item" wx:if="{{item.storeName}}">门店: {{item.storeName}}</text>
            <text class="detail-item" wx:if="{{item.orderTime}}">订单时间: {{item.orderTime}}</text>
          </view>
        </view>
        
        <view class="record-footer">
          <text class="record-time">{{item.formattedTime}}</text>
        </view>
      </view>
    </view>
    
    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{pointsRecords.length === 0 && !loading}}">
      <image class="empty-icon" src="/images/empty-orders.png" mode="aspectFit"></image>
      <text class="empty-text">暂无积分记录</text>
      <text class="empty-desc">消费后即可获得积分奖励</text>
    </view>
    
    <!-- 加载状态 -->
    <view class="loading-state" wx:if="{{loading}}">
      <text class="loading-text">加载中...</text>
    </view>
    
    <!-- 加载更多 -->
    <view class="load-more" wx:if="{{!loading && hasMore && pointsRecords.length > 0}}">
      <text class="load-more-text">上拉加载更多</text>
    </view>
    
    <!-- 没有更多数据 -->
    <view class="no-more" wx:if="{{!hasMore && pointsRecords.length > 0}}">
      <text class="no-more-text">没有更多记录了</text>
    </view>
  </view>
</view> 