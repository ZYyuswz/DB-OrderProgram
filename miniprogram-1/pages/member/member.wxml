<!--member.wxml-->
<view class="container">
  <!-- 会员卡片 -->
  <view class="member-card">
    <view class="member-header">
      <view class="member-level-badge" style="background: {{memberInfo.currentLevelInfo.color}}">
        <text class="level-icon">{{memberInfo.currentLevelInfo.icon}}</text>
        <text class="level-name">{{memberInfo.currentLevelName}}</text>
      </view>
      <view class="member-info">
        <text class="member-name">{{memberInfo.customerName}}</text>
        <text class="member-since">会员时长: {{memberSince}}</text>
      </view>
    </view>
    
    <!-- 消费信息 -->
    <view class="consumption-info">
      <view class="consumption-item">
        <text class="consumption-label">累计消费</text>
        <text class="consumption-value">¥{{memberInfo.totalConsumption}}</text>
      </view>
      <view class="consumption-item">
        <text class="consumption-label">当前积分</text>
        <text class="consumption-value">{{memberInfo.vipPoints}}</text>
      </view>
    </view>

    <!-- 升级进度 -->
    <view class="upgrade-progress" wx:if="{{memberInfo.nextLevel}}">
      <view class="progress-header">
        <text class="progress-title">距离 {{memberInfo.nextLevelName}} 还需</text>
        <text class="progress-amount">¥{{remainingAmount}}</text>
      </view>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{memberInfo.progressToNextLevel}}%"></view>
      </view>
      <view class="progress-footer">
        <text class="progress-current">¥{{memberInfo.totalConsumption}}</text>
        <text class="progress-target">¥{{memberInfo.nextLevelThreshold}}</text>
      </view>
    </view>

    <!-- 最高等级提示 -->
    <view class="max-level-tip" wx:if="{{!memberInfo.nextLevel}}">
      <text class="tip-icon">👑</text>
      <text class="tip-text">恭喜！您已达到最高会员等级</text>
    </view>
  </view>

  <!-- 会员特权 -->
  <view class="privileges-section">
    <view class="section-title">
      <text>会员特权</text>
    </view>
    
    <view class="privileges-list">
      <view 
        class="privilege-item" 
        wx:for="{{memberInfo.privileges}}" 
        wx:key="privilegeType"
      >
        <view class="privilege-icon">{{item.privilegeIcon}}</view>
        <view class="privilege-content">
          <view class="privilege-name">{{item.privilegeName}}</view>
          <view class="privilege-desc">{{item.privilegeDesc}}</view>
        </view>
        <view class="privilege-value">{{item.privilegeValue}}</view>
      </view>
    </view>
  </view>

  <!-- 消费统计 -->
  <view class="stats-section">
    <view class="section-title">
      <text>消费统计</text>
    </view>
    
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-number">{{stats.totalOrders}}</text>
        <text class="stat-label">总订单数</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">¥{{stats.averageOrderAmount}}</text>
        <text class="stat-label">平均消费</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.monthlyOrders}}</text>
        <text class="stat-label">本月订单</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">¥{{stats.monthlyConsumption}}</text>
        <text class="stat-label">本月消费</text>
      </view>
    </view>

    <view class="favorite-store" wx:if="{{stats.favoriteStore}}">
      <text class="store-label">常去门店: </text>
      <text class="store-name">{{stats.favoriteStore}}</text>
    </view>
  </view>

  <!-- 所有等级展示 -->
  <view class="levels-section">
    <view class="section-title">
      <text>会员等级体系</text>
    </view>
    
    <view class="levels-list">
      <view 
        class="level-item {{item.levelCode === memberInfo.currentLevel ? 'current' : ''}}" 
        wx:for="{{allLevels}}" 
        wx:key="levelCode"
        bindtap="showLevelDetail"
        data-level="{{item}}"
      >
        <view class="level-badge">
          <text class="level-icon">{{item.levelIcon}}</text>
        </view>
        <view class="level-info">
          <text class="level-name">{{item.levelName}}</text>
          <text class="level-threshold">
            消费满¥{{item.minConsumption}}
            <text wx:if="{{item.maxConsumption}}"> - ¥{{item.maxConsumption}}</text>
            <text wx:else="">以上</text>
          </text>
        </view>
        <view class="level-status">
          <text class="status-text" wx:if="{{item.levelCode === memberInfo.currentLevel}}">当前等级</text>
          <text class="status-icon" wx:else="{{memberInfo.totalConsumption >= item.minConsumption}}">✓</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading-state" wx:if="{{loading}}">
    <text class="loading-text">加载中...</text>
  </view>
</view>