<!--orders.wxml - 订单记录页面-->
<view class="container">

  
  <!-- 订单列表 -->
  <view class="orders-list" wx:if="{{orders.length > 0}}">
         <view 
       class="order-item" 
       wx:for="{{orders}}" 
       wx:key="orderId"
     >
             <!-- 订单头部信息（可点击查看详情） -->
       <view 
         class="order-header clickable"
         data-orderid="{{item.orderId}}"
         bindtap="viewOrderDetail"
       >
        <view class="order-info">
          <text class="order-id">订单号：{{item.orderId}}</text>
          <text class="order-time">{{item.orderTime}}</text>
        </view>
        <view class="order-status {{item.statusInfo.class}}">
          {{item.statusInfo.text}}
        </view>
      </view>

             <!-- 餐厅信息（可点击查看详情） -->
       <view 
         class="restaurant-info clickable"
         data-orderid="{{item.orderId}}"
         bindtap="viewOrderDetail"
       >
        <text class="store-name">{{item.storeName}}</text>
        <text class="table-number" wx:if="{{item.tableNumber}}">桌号：{{item.tableNumber}}</text>
      </view>

             <!-- 订单简要内容（可点击查看详情） -->
       <view 
         class="order-preview clickable"
         data-orderid="{{item.orderId}}"
         bindtap="viewOrderDetail"
       >
        <view class="dishes-preview">
          <text 
            class="dish-item" 
            wx:for="{{item.details}}" 
            wx:for-item="dish" 
            wx:key="dishName"
            wx:if="{{index < 3}}"
          >
            {{dish.dishName}} x{{dish.quantity}}{{index < item.details.length - 1 && index < 2 ? '，' : ''}}
          </text>
          <text class="more-dishes" wx:if="{{item.details.length > 3}}">
            等{{item.details.length}}道菜
          </text>
        </view>
      </view>

      <!-- 订单底部 -->
      <view class="order-footer">
                 <view 
           class="price-info clickable"
           data-orderid="{{item.orderId}}"
           bindtap="viewOrderDetail"
         >
          <text class="total-price">¥{{item.totalPrice}}</text>
        </view>
        <view class="order-actions">
                     <button 
             class="action-btn {{item.hasReview ? 'reviewed-btn' : 'review-btn'}}" 
             data-orderid="{{item.orderId}}"
             bindtap="{{item.hasReview ? '' : 'goToReview'}}"
             disabled="{{item.hasReview}}"
           >
             {{item.hasReview ? '已评价' : '评价'}}
           </button>
        </view>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{orders.length === 0 && !loading}}">
    <image class="empty-icon" src="/images/empty-orders.png" mode="widthFix"></image>
    <text class="empty-text">暂无订单记录</text>
    <text class="empty-desc">快去点餐享受美食吧！</text>
    <button class="go-order-btn" bindtap="goToOrder">立即点餐</button>
  </view>

  <!-- 加载状态 -->
  <view class="loading-state" wx:if="{{loading}}">
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 加载更多提示 -->
  <view class="load-more" wx:if="{{!hasMore && orders.length > 0}}">
    <text class="no-more-text">已加载全部订单</text>
  </view>
</view>

<!-- 订单详情弹窗 -->
<view class="modal-overlay" wx:if="{{showDetail}}" bindtap="closeDetail">
  <view class="modal-content" catchtap="true">
    <view class="modal-header">
      <text class="modal-title">订单详情</text>
      <text class="close-btn" bindtap="closeDetail">×</text>
    </view>
    
    <view class="detail-content" wx:if="{{selectedOrder}}">
      <!-- 订单基本信息 -->
      <view class="detail-section">
        <view class="section-title">订单信息</view>
        <view class="info-row">
          <text class="label">订单号：</text>
          <text class="value">{{selectedOrder.orderId}}</text>
        </view>
        <view class="info-row">
          <text class="label">下单时间：</text>
          <text class="value">{{selectedOrder.orderTime}}</text>
        </view>
        <view class="info-row">
          <text class="label">餐厅：</text>
          <text class="value">{{selectedOrder.storeName}}</text>
        </view>
        <view class="info-row" wx:if="{{selectedOrder.tableNumber}}">
          <text class="label">桌号：</text>
          <text class="value">{{selectedOrder.tableNumber}}</text>
        </view>
        <view class="info-row">
          <text class="label">状态：</text>
          <text class="value status-text {{selectedOrder.statusInfo.class}}">
            {{selectedOrder.statusInfo.text}}
          </text>
        </view>
      </view>

      <!-- 菜品详情 -->
      <view class="detail-section">
        <view class="section-title">菜品详情</view>
        <view class="dishes-list">
          <view 
            class="dish-detail" 
            wx:for="{{selectedOrder.details}}" 
            wx:key="dishName"
          >
            <view class="dish-info">
              <text class="dish-name">{{item.dishName || '未知菜品'}}</text>
              <text class="dish-price">¥{{item.unitPrice || 0}} × {{item.quantity || 0}}</text>
            </view>
            <text class="dish-subtotal">¥{{item.subtotal || 0}}</text>
          </view>
        </view>
        
        <!-- 如果没有详情数据，显示提示 -->
        <view class="no-details" wx:if="{{!selectedOrder.details || selectedOrder.details.length === 0}}">
          <text class="no-details-text">暂无菜品详情</text>
        </view>
      </view>

      <!-- 价格汇总 -->
      <view class="detail-section">
        <view class="price-summary">
          <view class="summary-row">
            <text class="summary-label">总计：</text>
            <text class="summary-price">¥{{selectedOrder.totalPrice}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>