<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>员工管理 - 餐饮管理系统</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <nav class="navbar">
        <h1>餐饮管理系统</h1>
        <div class="nav-links">
            <a href="index.html">首页</a>
            <a href="tables.html">桌台管理</a>
            <a href="orders.html">订单管理</a>
            <a href="menu.html">菜单管理</a>
            <a href="staff.html" class="active">员工管理</a>
            <a href="inventory.html">库存管理</a>
        </div>
    </nav>

    <div class="container">
        <div class="main-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2>员工管理</h2>
                <div>
                    <button onclick="showAddStaffModal()" class="btn btn-primary" data-permission="staff">添加员工</button>
                    <button onclick="exportData()" class="btn btn-info">导出数据</button>
                </div>
            </div>

            <!-- Tab 导航 -->
            <div class="tab-navigation">
                <button class="tab-btn active" onclick="switchTab('staff')">员工管理</button>
                <button class="tab-btn" onclick="switchTab('attendance')">考勤记录</button>
                <button class="tab-btn" onclick="switchTab('statistics')">考勤统计</button>
            </div>

            <!-- 统计卡片 -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-staff">0</div>
                    <div class="stat-label">员工总数</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="active-staff">0</div>
                    <div class="stat-label">在职员工</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="today-attendance">0</div>
                    <div class="stat-label">今日出勤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="today-late">0</div>
                    <div class="stat-label">今日迟到</div>
                </div>
            </div>

            <!-- 员工管理Tab -->
            <div id="staffTab" class="tab-content active">
                <!-- 搜索和过滤器 -->
                <div class="card">
                    <h3>员工筛选</h3>
                    <div class="search-filters">
                        <div class="form-group">
                            <label for="departmentFilter">部门筛选:</label>
                            <select id="departmentFilter" class="form-control" onchange="filterStaff()">
                                <option value="all">全部部门</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="storeFilter">门店筛选:</label>
                            <select id="storeFilter" class="form-control" onchange="filterStaff()">
                                <option value="all">全部门店</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="positionFilter">职位筛选:</label>
                            <select id="positionFilter" class="form-control" onchange="filterStaff()">
                                <option value="all">全部职位</option>
                                <option value="服务员">服务员</option>
                                <option value="厨师">厨师</option>
                                <option value="收银员">收银员</option>
                                <option value="经理">经理</option>
                                <option value="清洁员">清洁员</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="statusFilter">在职状态:</label>
                            <select id="statusFilter" class="form-control" onchange="filterStaff()">
                                <option value="all">全部状态</option>
                                <option value="在职">在职</option>
                                <option value="离职">离职</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="staffSearch">员工搜索:</label>
                            <input type="text" id="staffSearch" class="form-control" placeholder="输入员工姓名" onkeyup="filterStaff()">
                        </div>
                    </div>
                </div>

                <!-- 员工列表 -->
                <div class="card">
                    <h3>员工列表</h3>
                    <div style="overflow-x: auto;">
                        <table class="table" id="staffTable">
                            <thead>
                                <tr>
                                    <th>员工ID</th>
                                    <th>姓名</th>
                                    <th>职位</th>
                                    <th>部门</th>
                                    <th>门店</th>
                                    <th>电话</th>
                                    <th>薪资</th>
                                    <th>状态</th>
                                    <th>入职日期</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="staffTableBody">
                                <!-- 员工数据将通过JavaScript动态填充 -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 快速打卡区域 -->
                <div class="card">
                    <h3>快速打卡</h3>
                    <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="quickCheckStaff">选择员工:</label>
                            <select id="quickCheckStaff" class="form-control" style="width: 200px;">
                                <option value="">请选择员工</option>
                            </select>
                        </div>
                        <button onclick="quickCheckIn()" class="btn btn-success">上班打卡</button>
                        <button onclick="quickCheckOut()" class="btn btn-warning">下班打卡</button>
                        <div class="current-time">
                            <i class="fas fa-clock"></i> 当前时间：<span id="currentTime"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 考勤记录Tab -->
            <div id="attendanceTab" class="tab-content">
                <!-- 考勤筛选 -->
                <div class="card">
                    <h3>考勤筛选</h3>
                    <div class="search-filters">
                        <div class="form-group">
                            <label for="attendanceStartDate">开始日期:</label>
                            <input type="date" id="attendanceStartDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="attendanceEndDate">结束日期:</label>
                            <input type="date" id="attendanceEndDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="attendanceStaffFilter">员工筛选:</label>
                            <select id="attendanceStaffFilter" class="form-control">
                                <option value="">全部员工</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="attendanceStatusFilter">状态筛选:</label>
                            <select id="attendanceStatusFilter" class="form-control">
                                <option value="">全部状态</option>
                                <option value="正常">正常</option>
                                <option value="迟到">迟到</option>
                                <option value="早退">早退</option>
                                <option value="缺勤">缺勤</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button onclick="loadAttendanceRecords()" class="btn btn-primary">查询</button>
                            <button onclick="resetAttendanceFilter()" class="btn btn-secondary">重置</button>
                        </div>
                    </div>
                </div>

                <!-- 考勤记录列表 -->
                <div class="card">
                    <h3>考勤记录</h3>
                    <div style="overflow-x: auto;">
                        <table class="table" id="attendanceTable">
                            <thead>
                                <tr>
                                    <th>员工姓名</th>
                                    <th>部门</th>
                                    <th>日期</th>
                                    <th>上班时间</th>
                                    <th>下班时间</th>
                                    <th>工作时长</th>
                                    <th>状态</th>
                                    <th>备注</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceTableBody">
                                <!-- 考勤数据将通过JavaScript动态填充 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 考勤统计Tab -->
            <div id="statisticsTab" class="tab-content">
                <!-- 统计筛选 -->
                <div class="card">
                    <h3>统计条件</h3>
                    <div class="search-filters">
                        <div class="form-group">
                            <label for="statsStartDate">开始日期:</label>
                            <input type="date" id="statsStartDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="statsEndDate">结束日期:</label>
                            <input type="date" id="statsEndDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="statsDepartmentFilter">部门筛选:</label>
                            <select id="statsDepartmentFilter" class="form-control">
                                <option value="">全部部门</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button onclick="loadAttendanceStatistics()" class="btn btn-primary">生成统计</button>
                        </div>
                    </div>
                </div>

                <!-- 统计结果 -->
                <div class="card">
                    <h3>考勤统计报表</h3>
                    <div style="overflow-x: auto;">
                        <table class="table" id="statisticsTable">
                            <thead>
                                <tr>
                                    <th>员工姓名</th>
                                    <th>部门</th>
                                    <th>总出勤天数</th>
                                    <th>正常天数</th>
                                    <th>迟到天数</th>
                                    <th>早退天数</th>
                                    <th>缺勤天数</th>
                                    <th>总工时</th>
                                    <th>平均工时</th>
                                    <th>出勤率</th>
                                </tr>
                            </thead>
                            <tbody id="statisticsTableBody">
                                <!-- 统计数据将通过JavaScript动态填充 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加/编辑员工模态框 -->
    <div id="addStaffModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="staffModalTitle">添加员工</h3>
                <span class="close">&times;</span>
            </div>
            <form id="staffForm">
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="staffName">员工姓名:</label>
                            <input type="text" id="staffName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="staffGender">性别:</label>
                            <select id="staffGender" class="form-control" required>
                                <option value="">请选择性别</option>
                                <option value="M">男</option>
                                <option value="F">女</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="staffPosition">职位:</label>
                            <select id="staffPosition" class="form-control" required>
                                <option value="">请选择职位</option>
                                <option value="服务员">服务员</option>
                                <option value="厨师">厨师</option>
                                <option value="收银员">收银员</option>
                                <option value="经理">经理</option>
                                <option value="清洁员">清洁员</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="staffEmail">邮箱:</label>
                            <input type="email" id="staffEmail" class="form-control" placeholder="可选">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="staffPhone">联系电话:</label>
                            <input type="tel" id="staffPhone" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="staffSalary">薪资(元/月):</label>
                            <input type="number" id="staffSalary" class="form-control" min="0" step="100" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="staffDepartment">所属部门:</label>
                            <select id="staffDepartment" class="form-control" required>
                                <option value="">请选择部门</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="staffStore">所属门店:</label>
                            <select id="staffStore" class="form-control" required>
                                <option value="">请选择门店</option>
                            </select>
                        </div>
                     </div>
                    <div class="form-group">
                        <label for="workSchedule">工作安排:</label>
                        <textarea id="workSchedule" class="form-control" rows="3" placeholder="如：周一至周五 9:00-18:00"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="Utils.hideModal('addStaffModal')" class="btn btn-secondary">取消</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 考勤管理模态框 -->
    <div id="attendanceModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3>考勤记录</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <!-- 考勤查询条件 -->
                <div class="search-filters" style="margin-bottom: 1rem;">
                    <div class="form-group">
                        <label for="attendanceStaffFilter">员工筛选:</label>
                        <select id="attendanceStaffFilter" class="form-control" onchange="loadAttendanceRecords()">
                            <option value="">全部员工</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="attendanceDateStart">开始日期:</label>
                        <input type="date" id="attendanceDateStart" class="form-control" onchange="loadAttendanceRecords()">
                    </div>
                    <div class="form-group">
                        <label for="attendanceDateEnd">结束日期:</label>
                        <input type="date" id="attendanceDateEnd" class="form-control" onchange="loadAttendanceRecords()">
                    </div>
                </div>

                <!-- 考勤记录表格 -->
                <div style="overflow-x: auto;">
                    <table class="table" id="attendanceTable">
                        <thead>
                            <tr>
                                <th>员工姓名</th>
                                <th>工作日期</th>
                                <th>上班时间</th>
                                <th>下班时间</th>
                                <th>工作时长</th>
                                <th>状态</th>
                            </tr>
                        </thead>
                        <tbody id="attendanceTableBody">
                            <!-- 考勤数据将通过JavaScript动态填充 -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="Utils.hideModal('attendanceModal')" class="btn btn-secondary">关闭</button>
                <button onclick="exportAttendance()" class="btn btn-primary">导出考勤</button>
            </div>
        </div>
    </div>

    <!-- 员工详情模态框 -->
    <div id="staffDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="staffDetailTitle">员工详情</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body" id="staffDetailBody">
                <!-- 员工详情内容将通过JavaScript动态填充 -->
            </div>
            <div class="modal-footer">
                <button onclick="Utils.hideModal('staffDetailModal')" class="btn btn-secondary">关闭</button>
                <button id="editStaffBtn" onclick="editCurrentStaff()" class="btn btn-primary">编辑</button>
            </div>
        </div>
    </div>

    <script src="js/common.js"></script>
    <script src="js/auth.js"></script>
    <script>
        let allStaff = [];
        let filteredStaff = [];
        let attendanceRecords = [];
        let currentStaffId = null;
        let allDepartments = [];
        let allStores = [];
        let currentTab = 'staff';

        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializeData();
            setupEventListeners();
            setDefaultDates();
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
        });

        // 按正确顺序加载数据
        async function initializeData() {
            try {
                // 先加载部门和门店数据
                await loadDepartmentsAndStores();
                // 然后加载员工数据并渲染
                await loadStaff();
            } catch (error) {
                console.error('初始化数据失败:', error);
                Utils.showNotification('初始化数据失败', 'error');
            }
        }

        function setupEventListeners() {
            // 员工表单提交
            document.getElementById('staffForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleStaffSubmit();
            });
        }

        function updateCurrentTime() {
            const now = new Date();
            const timeElement = document.getElementById('currentTime');
            if (timeElement) {
                timeElement.textContent = now.toLocaleString('zh-CN');
            }
        }

        // Tab切换功能
        function switchTab(tabName) {
            // 移除所有活跃状态
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // 添加活跃状态
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            currentTab = tabName;
            
            // 根据Tab加载相应数据
            if (tabName === 'attendance') {
                loadAttendanceRecords();
            } else if (tabName === 'statistics') {
                loadAttendanceStatistics();
            }
        }

        function setDefaultDates() {
            const today = new Date();
            const weekAgo = new Date(today);
            weekAgo.setDate(today.getDate() - 7);
            const monthAgo = new Date(today);
            monthAgo.setMonth(today.getMonth() - 1);

            // 考勤记录默认查询最近一周
            const attendanceStartDate = document.getElementById('attendanceStartDate');
            const attendanceEndDate = document.getElementById('attendanceEndDate');
            if (attendanceStartDate) attendanceStartDate.value = weekAgo.toISOString().split('T')[0];
            if (attendanceEndDate) attendanceEndDate.value = today.toISOString().split('T')[0];

            // 统计默认查询最近一个月
            const statsStartDate = document.getElementById('statsStartDate');
            const statsEndDate = document.getElementById('statsEndDate');
            if (statsStartDate) statsStartDate.value = monthAgo.toISOString().split('T')[0];
            if (statsEndDate) statsEndDate.value = today.toISOString().split('T')[0];
        }

        async function loadStaff() {
            try {
                allStaff = await API.get('/staff');
                filteredStaff = [...allStaff];
                renderStaffTable();
                populateStaffSelects();
                updateStatistics();
            } catch (error) {
                console.error('加载员工数据失败:', error);
                Utils.showNotification('加载员工数据失败', 'error');
            }
        }

        function renderStaffTable() {
            const tbody = document.getElementById('staffTableBody');
            tbody.innerHTML = '';

            if (filteredStaff.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; color: #666;">暂无员工数据</td></tr>';
                return;
            }

            filteredStaff.forEach(staff => {
                const row = document.createElement('tr');
                
                // 获取状态，确保字段名兼容性
                const staffStatus = staff.Status || staff.status || staff.STATUS || '在职';
                const statusInfo = Utils.getStatusInfo(staffStatus, 'staff');
                
                // 获取部门名称 - 统一使用大写字段名匹配
                const staffDeptId = staff.DepartmentID || staff.departmentID || staff.DEPARTMENTID;
                const department = allDepartments.find(d => {
                    const deptId = d.DepartmentID || d.departmentID || d.DEPARTMENTID;
                    return deptId === staffDeptId;
                });
                const departmentName = department ? (department.DepartmentName || department.departmentName || department.DEPARTMENTNAME || '未知部门') : '未知部门';
                
                // 获取门店名称 - 统一使用大写字段名匹配  
                const staffStoreId = staff.StoreID || staff.storeID || staff.STOREID;
                const store = allStores.find(s => {
                    const storeId = s.StoreID || s.storeID || s.STOREID;
                    return storeId === staffStoreId;
                });
                const storeName = store ? (store.StoreName || store.storeName || store.STORENAME || '未知门店') : '未知门店';
                
                row.innerHTML = `
                    <td>${staff.StaffID || staff.staffID || staff.STAFFID || 'N/A'}</td>
                    <td>${staff.StaffName || staff.staffName || staff.STAFFNAME || '未知'}</td>
                    <td>${staff.Position || staff.position || staff.POSITION || '未设置'}</td>
                    <td>${departmentName}</td>
                    <td>${storeName}</td>
                    <td>${staff.Phone || staff.phone || staff.PHONE || '未设置'}</td>
                    <td>${Utils.formatCurrency(staff.Salary || staff.salary || staff.SALARY || 0)}</td>
                    <td><span class="status-badge ${statusInfo.class}">${statusInfo.text}</span></td>
                    <td>${Utils.formatDate(staff.HireDate || staff.hireDate || staff.HIREDATE)}</td>
                    <td>
                        <button onclick="viewStaffDetails(${staff.StaffID || staff.staffID || staff.STAFFID})" class="btn btn-primary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem; margin-right: 0.25rem;">详情</button>
                        <button onclick="editStaff(${staff.StaffID || staff.staffID || staff.STAFFID})" class="btn btn-secondary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem; margin-right: 0.25rem;">编辑</button>
                        ${staffStatus === '在职' ? `
                            <button onclick="toggleStaffStatus(${staff.StaffID || staff.staffID || staff.STAFFID}, '离职')" class="btn btn-danger" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">离职</button>
                        ` : `
                            <button onclick="toggleStaffStatus(${staff.StaffID || staff.staffID || staff.STAFFID}, '在职')" class="btn btn-success" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">复职</button>
                        `}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function populateStaffSelects() {
            const quickCheckStaff = document.getElementById('quickCheckStaff');
            const attendanceStaffFilter = document.getElementById('attendanceStaffFilter');
            
            // 清空现有选项
            quickCheckStaff.innerHTML = '<option value="">请选择员工</option>';
            attendanceStaffFilter.innerHTML = '<option value="">全部员工</option>';
            
            const activeStaff = allStaff.filter(s => (s.Status || s.status || s.STATUS) === '在职');
            
            activeStaff.forEach(staff => {
                const quickOption = document.createElement('option');
                quickOption.value = staff.StaffID || staff.staffID || staff.STAFFID;
                quickOption.textContent = staff.StaffName || staff.staffName || staff.STAFFNAME;
                quickCheckStaff.appendChild(quickOption);
            });

            allStaff.forEach(staff => {
                const filterOption = document.createElement('option');
                filterOption.value = staff.StaffID || staff.staffID || staff.STAFFID;
                filterOption.textContent = staff.StaffName || staff.staffName || staff.STAFFNAME;
                attendanceStaffFilter.appendChild(filterOption);
            });
        }

        function filterStaff() {
            const departmentFilter = document.getElementById('departmentFilter').value;
            const storeFilter = document.getElementById('storeFilter').value;
            const positionFilter = document.getElementById('positionFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const staffSearch = document.getElementById('staffSearch').value.trim().toLowerCase();

            filteredStaff = allStaff.filter(staff => {
                const staffDeptId = staff.DepartmentID || staff.departmentID || staff.DEPARTMENTID;
                const staffStoreId = staff.StoreID || staff.storeID || staff.STOREID;
                const staffPosition = staff.Position || staff.position || staff.POSITION;
                const staffStatus = staff.Status || staff.status || staff.STATUS;
                const staffName = staff.StaffName || staff.staffName || staff.STAFFNAME || '';
                
                const departmentMatch = departmentFilter === 'all' || staffDeptId == departmentFilter;
                const storeMatch = storeFilter === 'all' || staffStoreId == storeFilter;
                const positionMatch = positionFilter === 'all' || staffPosition === positionFilter;
                const statusMatch = statusFilter === 'all' || staffStatus === statusFilter;
                const nameMatch = !staffSearch || staffName.toLowerCase().includes(staffSearch);

                return departmentMatch && storeMatch && positionMatch && statusMatch && nameMatch;
            });

            renderStaffTable();
        }

        async function updateStatistics() {
            const totalStaff = allStaff.length;
            const activeStaff = allStaff.filter(s => (s.Status || s.status || s.STATUS) === '在职').length;

            document.getElementById('total-staff').textContent = totalStaff;
            document.getElementById('active-staff').textContent = activeStaff;

            // 获取今日出勤统计和迟到统计
            try {
                const today = new Date().toISOString().split('T')[0];
                const todayAttendance = await API.get(`/staff/attendance?startDate=${today}&endDate=${today}`);
                const todayLate = todayAttendance.filter(a => (a.StatusAnalysis || a.Status) === '迟到').length;
                
                document.getElementById('today-attendance').textContent = todayAttendance.length;
                document.getElementById('today-late').textContent = todayLate;
            } catch (error) {
                console.error('获取今日出勤统计失败:', error);
                document.getElementById('today-attendance').textContent = '-';
                document.getElementById('today-late').textContent = '-';
            }
        }

        // 考勤管理相关函数
        async function loadAttendanceRecords() {
            try {
                const startDate = document.getElementById('attendanceDateStart').value;
                const endDate = document.getElementById('attendanceDateEnd').value;
                const staffId = document.getElementById('attendanceStaffFilter').value;
                
                let url = '/staff/attendance?';
                const params = new URLSearchParams();
                
                if (startDate) params.append('startDate', startDate);
                if (endDate) params.append('endDate', endDate);
                if (staffId) params.append('staffId', staffId);
                
                url += params.toString();
                
                attendanceRecords = await API.get(url);
                
                renderAttendanceTable();
            } catch (error) {
                console.error('加载考勤记录失败:', error);
                Utils.showNotification('加载考勤记录失败', 'error');
            }
        }

        function renderAttendanceTable() {
            const tbody = document.getElementById('attendanceTableBody');
            tbody.innerHTML = '';

            if (attendanceRecords.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">暂无考勤记录</td></tr>';
                return;
            }

            attendanceRecords.forEach(record => {
                const row = document.createElement('tr');
                // 兼容后端返回的各种字段名
                const staffName = record.StaffName || record.staffName || record.STAFFNAME || '未知员工';
                const departmentName = record.DepartmentName || record.departmentName || record.DEPARTMENTNAME || '未知部门';
                const workDate = record.WorkDate || record.workDate || record.WORKDATE;
                const checkInTime = record.CheckInTime || record.checkInTime || record.CHECKINTIME;
                const checkOutTime = record.CheckOutTime || record.checkOutTime || record.CHECKOUTTIME;
                const actualWorkHours = record.ActualWorkHours || record.actualWorkHours || record.ACTUALWORKHOURS;
                const status = record.StatusAnalysis || record.Status || record.status || record.STATUS;
                const attendanceId = record.AttendanceID || record.attendanceID || record.ATTENDANCEID;

                const statusInfo = getAttendanceStatusInfo(status);

                row.innerHTML = `
                    <td>${staffName}</td>
                    <td>${departmentName}</td>
                    <td>${workDate ? Utils.formatDate(workDate) : '-'}</td>
                    <td>${checkInTime ? Utils.formatDateTime(checkInTime) : '<span class="text-muted">未打卡</span>'}</td>
                    <td>${checkOutTime ? Utils.formatDateTime(checkOutTime) : '<span class="text-muted">未打卡</span>'}</td>
                    <td>${actualWorkHours ? parseFloat(actualWorkHours).toFixed(1) + '小时' : '<span class="text-muted">-</span>'}</td>
                    <td><span class="status-badge ${statusInfo.class}">${statusInfo.text}</span></td>
                    <td><span class="text-muted">-</span></td>
                    <td>
                        <button onclick="editAttendanceRecord(${attendanceId})" class="btn btn-sm btn-primary">编辑</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function getAttendanceStatusInfo(status) {
            const statusMap = {
                '正常': { class: 'status-success', text: '正常' },
                '迟到': { class: 'status-warning', text: '迟到' },
                '早退': { class: 'status-orange', text: '早退' },
                '缺勤': { class: 'status-danger', text: '缺勤' }
            };
            return statusMap[status] || { class: 'status-secondary', text: status || '未知' };
        }

        function resetAttendanceFilter() {
            document.getElementById('attendanceStaffFilter').value = '';
            document.getElementById('attendanceStatusFilter').value = '';
            setDefaultDates();
            loadAttendanceRecords();
        }

        async function loadAttendanceStatistics() {
            try {
                const startDate = document.getElementById('statsStartDate').value;
                const endDate = document.getElementById('statsEndDate').value;
                const departmentId = document.getElementById('statsDepartmentFilter').value;
                
                let url = `/staff/attendance/statistics?startDate=${startDate}&endDate=${endDate}`;
                if (departmentId) {
                    url += `&departmentId=${departmentId}`;
                }
                
                const statistics = await API.get(url);
                renderStatisticsTable(statistics);
            } catch (error) {
                console.error('加载考勤统计失败:', error);
                Utils.showNotification('加载考勤统计失败', 'error');
            }
        }

        function renderStatisticsTable(statistics) {
            const tbody = document.getElementById('statisticsTableBody');
            tbody.innerHTML = '';

            if (statistics.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; color: #666;">暂无统计数据</td></tr>';
                return;
            }

            statistics.forEach(stat => {
                const row = document.createElement('tr');
                const attendanceRate = stat.TotalDays > 0 ? 
                    ((stat.TotalDays - stat.AbsentDays) / stat.TotalDays * 100).toFixed(1) : 0;
                
                // 获取部门名称
                const staff = allStaff.find(s => 
                    (s.StaffID || s.staffID || s.STAFFID) === stat.StaffID
                );
                const staffDeptId = staff ? (staff.DepartmentID || staff.departmentID || staff.DEPARTMENTID) : null;
                const department = allDepartments.find(d => 
                    (d.DepartmentID || d.departmentID || d.DEPARTMENTID) === staffDeptId
                );
                const departmentName = department ? 
                    (department.DepartmentName || department.departmentName || department.DEPARTMENTNAME) : '未知部门';
                
                row.innerHTML = `
                    <td>${stat.StaffName}</td>
                    <td>${departmentName}</td>
                    <td>${stat.TotalDays}</td>
                    <td>${stat.NormalDays}</td>
                    <td>${stat.LateDays}</td>
                    <td>${stat.EarlyLeaveDays}</td>
                    <td>${stat.AbsentDays}</td>
                    <td>${parseFloat(stat.TotalWorkHours || 0).toFixed(1)}小时</td>
                    <td>${parseFloat(stat.AverageWorkHours || 0).toFixed(1)}小时</td>
                    <td>
                        <span class="attendance-rate ${attendanceRate >= 95 ? 'excellent' : attendanceRate >= 85 ? 'good' : 'poor'}">
                            ${attendanceRate}%
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function showAddStaffModal() {
            currentStaffId = null;
            document.getElementById('staffModalTitle').textContent = '添加员工';
            Utils.resetForm(document.getElementById('staffForm'));
            Utils.showModal('addStaffModal');
        }

        async function handleStaffSubmit() {
            if (!Utils.validateForm(document.getElementById('staffForm'))) {
                Utils.showNotification('请填写完整信息', 'warning');
                return;
            }

            try {
                const staffData = {
                    staffName: document.getElementById('staffName').value,
                    gender: document.getElementById('staffGender').value,
                    position: document.getElementById('staffPosition').value,
                    phone: document.getElementById('staffPhone').value,
                    email: document.getElementById('staffEmail').value || null,
                    salary: parseFloat(document.getElementById('staffSalary').value),
                    departmentID: parseInt(document.getElementById('staffDepartment').value),
                    storeID: parseInt(document.getElementById('staffStore').value),
                    workSchedule: document.getElementById('workSchedule').value || null
                };

                // 验证必填字段
                if (!staffData.gender) {
                    Utils.showNotification('请选择性别', 'warning');
                    return;
                }
                
                if (!staffData.departmentID || !staffData.storeID) {
                    Utils.showNotification('请选择部门和门店', 'warning');
                    return;
                }

                if (currentStaffId) {
                    // 编辑员工时保持原有状态
                    const currentStaff = allStaff.find(s => (s.StaffID || s.staffID || s.STAFFID) === currentStaffId);
                    if (currentStaff) {
                        staffData.status = currentStaff.Status || currentStaff.status || currentStaff.STATUS || '在职';
                    }
                    staffData.staffID = currentStaffId;
                    await API.put(`/staff/${currentStaffId}`, staffData);
                    Utils.showNotification('员工信息更新成功', 'success');
                } else {
                    // 新增员工时设置默认状态
                    staffData.status = '在职';
                    await API.post('/staff', staffData);
                    Utils.showNotification('员工添加成功', 'success');
                }

                Utils.hideModal('addStaffModal');
                await loadStaff();

            } catch (error) {
                console.error('保存员工信息失败:', error);
                Utils.showNotification('保存员工信息失败', 'error');
            }
        }

        function editStaff(staffId) {
            const staff = allStaff.find(s => (s.StaffID || s.staffID || s.STAFFID) === staffId);
            if (!staff) return;

            // 兼容各种字段名格式
            const staffName = staff.StaffName || staff.staffName || staff.STAFFNAME;
            const gender = staff.Gender || staff.gender || staff.GENDER;
            const position = staff.Position || staff.position || staff.POSITION;
            const phone = staff.Phone || staff.phone || staff.PHONE;
            const email = staff.Email || staff.email || staff.EMAIL;
            const salary = staff.Salary || staff.salary || staff.SALARY;
            const departmentID = staff.DepartmentID || staff.departmentID || staff.DEPARTMENTID;
            const storeID = staff.StoreID || staff.storeID || staff.STOREID;
            const workSchedule = staff.WorkSchedule || staff.workSchedule || staff.WORKSCHEDULE;

            currentStaffId = staffId;
            document.getElementById('staffModalTitle').textContent = '编辑员工信息';
            document.getElementById('staffName').value = staffName || '';
            document.getElementById('staffGender').value = gender || '';
            document.getElementById('staffPosition').value = position || '';
            document.getElementById('staffPhone').value = phone || '';
            document.getElementById('staffEmail').value = email || '';
            document.getElementById('staffSalary').value = salary || '';
            document.getElementById('staffDepartment').value = departmentID || '';
            document.getElementById('staffStore').value = storeID || '';
            document.getElementById('workSchedule').value = workSchedule || '';
            
            Utils.showModal('addStaffModal');
        }

        async function viewStaffDetails(staffId) {
            const staff = allStaff.find(s => (s.StaffID || s.staffID || s.STAFFID) === staffId);
            if (!staff) return;

            // 兼容各种字段名格式
            const staffID = staff.StaffID || staff.staffID || staff.STAFFID;
            const staffName = staff.StaffName || staff.staffName || staff.STAFFNAME;
            const gender = staff.Gender || staff.gender || staff.GENDER;
            const position = staff.Position || staff.position || staff.POSITION;
            const phone = staff.Phone || staff.phone || staff.PHONE;
            const email = staff.Email || staff.email || staff.EMAIL;
            const salary = staff.Salary || staff.salary || staff.SALARY;
            const status = staff.Status || staff.status || staff.STATUS;
            const hireDate = staff.HireDate || staff.hireDate || staff.HIREDATE;
            const workSchedule = staff.WorkSchedule || staff.workSchedule || staff.WORKSCHEDULE;
            const departmentID = staff.DepartmentID || staff.departmentID || staff.DEPARTMENTID;
            const storeID = staff.StoreID || staff.storeID || staff.STOREID;

            document.getElementById('staffDetailTitle').textContent = `员工详情 - ${staffName}`;
            
            const statusInfo = Utils.getStatusInfo(status, 'staff');
            
            // 获取部门名称
            const department = allDepartments.find(d => 
                (d.DepartmentID || d.departmentID || d.DEPARTMENTID) === departmentID
            );
            const departmentName = department ? (department.DepartmentName || department.departmentName || department.DEPARTMENTNAME || '未知部门') : '未知部门';
            
            // 获取门店名称
            const store = allStores.find(s => 
                (s.StoreID || s.storeID || s.STOREID) === storeID
            );
            const storeName = store ? (store.StoreName || store.storeName || store.STORENAME || '未知门店') : '未知门店';
            
            const detailsHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                    <div><strong>员工ID:</strong> ${staffID}</div>
                    <div><strong>姓名:</strong> ${staffName}</div>
                    <div><strong>性别:</strong> ${gender === 'M' ? '男' : gender === 'F' ? '女' : '未设置'}</div>
                    <div><strong>职位:</strong> ${position || '未设置'}</div>
                    <div><strong>所属部门:</strong> ${departmentName}</div>
                    <div><strong>所属门店:</strong> ${storeName}</div>
                    <div><strong>联系电话:</strong> ${phone || '未设置'}</div>
                    <div><strong>邮箱:</strong> ${email || '未设置'}</div>
                    <div><strong>薪资:</strong> ${Utils.formatCurrency(salary || 0)}/月</div>
                    <div><strong>状态:</strong> <span class="status-badge ${statusInfo.class}">${statusInfo.text}</span></div>
                    <div><strong>入职日期:</strong> ${Utils.formatDate(hireDate)}</div>
                </div>
                ${workSchedule ? `
                    <div>
                        <strong>工作安排:</strong>
                        <p style="margin-top: 0.5rem; padding: 1rem; background-color: #f8f9fa; border-radius: 4px;">${workSchedule}</p>
                    </div>
                ` : ''}
            `;

            document.getElementById('staffDetailBody').innerHTML = detailsHTML;
            currentStaffId = staffId;
            Utils.showModal('staffDetailModal');
        }

        async function loadDepartmentsAndStores() {
            try {
                // 并行加载部门和门店数据
                const [departmentsResponse, storesResponse] = await Promise.all([
                    API.get('/department'),
                    API.get('/store')
                ]);
                
                allDepartments = departmentsResponse || [];
                allStores = storesResponse || [];
                
                // 填充添加员工表单中的选择器
                const deptSelect = document.getElementById('staffDepartment');
                const storeSelect = document.getElementById('staffStore');
                
                if (deptSelect) {
                    deptSelect.innerHTML = '<option value="">请选择部门</option>';
                    allDepartments.forEach(dept => {
                        const option = document.createElement('option');
                        option.value = dept.DepartmentID || dept.departmentID || dept.DEPARTMENTID;
                        option.textContent = dept.DepartmentName || dept.departmentName || dept.DEPARTMENTNAME || '未知部门';
                        deptSelect.appendChild(option);
                    });
                }
                
                if (storeSelect) {
                    storeSelect.innerHTML = '<option value="">请选择门店</option>';
                    allStores.forEach(store => {
                        const option = document.createElement('option');
                        option.value = store.StoreID || store.storeID || store.STOREID;
                        option.textContent = store.StoreName || store.storeName || store.STORENAME || '未知门店';
                        storeSelect.appendChild(option);
                    });
                }
                
                // 填充筛选器中的选择器
                populateFilterSelects();
                
            } catch (error) {
                console.error('加载部门或门店数据失败:', error);
                Utils.showNotification('加载部门或门店数据失败', 'error');
            }
        }

        function populateFilterSelects() {
            // 填充部门筛选器
            const departmentFilter = document.getElementById('departmentFilter');
            if (departmentFilter) {
                departmentFilter.innerHTML = '<option value="all">全部部门</option>';
                allDepartments.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept.DepartmentID || dept.departmentID || dept.DEPARTMENTID;
                    option.textContent = dept.DepartmentName || dept.departmentName || dept.DEPARTMENTNAME || '未知部门';
                    departmentFilter.appendChild(option);
                });
            }
            
            // 填充门店筛选器
            const storeFilter = document.getElementById('storeFilter');
            if (storeFilter) {
                storeFilter.innerHTML = '<option value="all">全部门店</option>';
                allStores.forEach(store => {
                    const option = document.createElement('option');
                    option.value = store.StoreID || store.storeID || store.STOREID;
                    option.textContent = store.StoreName || store.storeName || store.STORENAME || '未知门店';
                    storeFilter.appendChild(option);
                });
            }

            // 填充统计页面的部门筛选器
            const statsDepartmentFilter = document.getElementById('statsDepartmentFilter');
            if (statsDepartmentFilter) {
                statsDepartmentFilter.innerHTML = '<option value="">全部部门</option>';
                allDepartments.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept.DepartmentID || dept.departmentID || dept.DEPARTMENTID;
                    option.textContent = dept.DepartmentName || dept.departmentName || dept.DEPARTMENTNAME || '未知部门';
                    statsDepartmentFilter.appendChild(option);
                });
            }
        }

        function editCurrentStaff() {
            if (!currentStaffId) return;
            Utils.hideModal('staffDetailModal');
            editStaff(currentStaffId);
        }

        async function toggleStaffStatus(staffId, newStatus) {
            const action = newStatus === '在职' ? '复职' : '离职';
            if (!Utils.showConfirm(`确认要为该员工办理${action}手续吗？`)) {
                return;
            }

            try {
                await API.put(`/staff/${staffId}/status`, newStatus);
                Utils.showNotification(`员工${action}成功`, 'success');
                await loadStaff();
            } catch (error) {
                console.error(`员工${action}失败:`, error);
                Utils.showNotification(`员工${action}失败`, 'error');
            }
        }

        async function quickCheckIn() {
            const staffId = document.getElementById('quickCheckStaff').value;
            if (!staffId) {
                Utils.showNotification('请选择员工', 'warning');
                return;
            }

            try {
                await API.post(`/staff/${staffId}/checkin`);
                Utils.showNotification('上班打卡成功', 'success');
                updateStatistics();
            } catch (error) {
                console.error('上班打卡失败:', error);
                Utils.showNotification('上班打卡失败', 'error');
            }
        }

        async function quickCheckOut() {
            const staffId = document.getElementById('quickCheckStaff').value;
            if (!staffId) {
                Utils.showNotification('请选择员工', 'warning');
                return;
            }

            try {
                await API.post(`/staff/${staffId}/checkout`);
                Utils.showNotification('下班打卡成功', 'success');
                updateStatistics();
            } catch (error) {
                console.error('下班打卡失败:', error);
                Utils.showNotification('下班打卡失败', 'error');
            }
        }

        async function showAttendanceModal() {
            Utils.showModal('attendanceModal');
            await loadAttendanceRecords();
        }

        async function loadAttendanceRecords() {
            try {
                const staffId = document.getElementById('attendanceStaffFilter').value;
                const startDate = document.getElementById('attendanceDateStart').value;
                const endDate = document.getElementById('attendanceDateEnd').value;

                let url = '/staff/attendance?';
                if (startDate) url += `startDate=${startDate}&`;
                if (endDate) url += `endDate=${endDate}&`;
                if (staffId) url += `staffId=${staffId}&`;

                attendanceRecords = await API.get(url);
                renderAttendanceTable();

            } catch (error) {
                console.error('加载考勤记录失败:', error);
                Utils.showNotification('加载考勤记录失败', 'error');
            }
        }

        function renderAttendanceTable() {
            const tbody = document.getElementById('attendanceTableBody');
            tbody.innerHTML = '';

            if (attendanceRecords.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">暂无考勤记录</td></tr>';
                return;
            }

            attendanceRecords.forEach(record => {
                const row = document.createElement('tr');
                // 处理Oracle数据库返回的大写字段名
                const status = record.STATUS || record.status || '正常';
                const statusInfo = Utils.getStatusInfo(status, 'attendance');
                
                // 格式化工作日期
                const workDate = record.WORKDATE || record.workDate;
                const formattedDate = workDate ? Utils.formatDate(workDate) : '-';
                
                // 格式化打卡时间
                const checkInTime = record.CHECKINTIME || record.checkInTime;
                const checkOutTime = record.CHECKOUTTIME || record.checkOutTime;
                const formattedCheckIn = checkInTime ? 
                    new Date(checkInTime).toLocaleTimeString('zh-CN', {hour12: false}) : '-';
                const formattedCheckOut = checkOutTime ? 
                    new Date(checkOutTime).toLocaleTimeString('zh-CN', {hour12: false}) : '-';
                
                // 格式化工作时长
                const workHours = record.WORKHOURS || record.workHours;
                const formattedWorkHours = workHours ? 
                    parseFloat(workHours).toFixed(1) + '小时' : '-';
                
                // 获取员工和部门信息
                const staffName = record.STAFFNAME || record.staffName || '未知员工';
                const departmentName = record.DEPARTMENTNAME || record.departmentName || '未知部门';
                const attendanceId = record.ATTENDANCEID || record.attendanceID;
                
                row.innerHTML = `
                    <td>${staffName}</td>
                    <td>${departmentName}</td>
                    <td>${formattedDate}</td>
                    <td>${formattedCheckIn}</td>
                    <td>${formattedCheckOut}</td>
                    <td>${formattedWorkHours}</td>
                    <td><span class="status-badge ${statusInfo.class}">${statusInfo.text}</span></td>
                    <td>-</td>
                    <td>
                        <button onclick="editAttendanceRecord(${attendanceId})" class="btn btn-sm btn-secondary">编辑</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function exportData() {
            if (currentTab === 'staff') {
                Utils.showNotification('导出员工数据功能待实现', 'info');
            } else if (currentTab === 'attendance') {
                Utils.showNotification('导出考勤记录功能待实现', 'info');
            } else if (currentTab === 'statistics') {
                Utils.showNotification('导出考勤统计功能待实现', 'info');
            }
        }

        function editAttendanceRecord(attendanceId) {
            Utils.showNotification('编辑考勤记录功能待实现', 'info');
        }

        // 加载考勤统计
        async function loadAttendanceStatistics() {
            try {
                const startDate = document.getElementById('statsStartDate').value;
                const endDate = document.getElementById('statsEndDate').value;
                const departmentId = document.getElementById('statsDepartmentFilter').value;

                let url = '/staff/attendance/statistics?';
                if (startDate) url += `startDate=${startDate}&`;
                if (endDate) url += `endDate=${endDate}&`;
                if (departmentId) url += `departmentId=${departmentId}&`;

                const statistics = await API.get(url);
                renderStatisticsTable(statistics);

            } catch (error) {
                console.error('加载考勤统计失败:', error);
                Utils.showNotification('加载考勤统计失败', 'error');
            }
        }

        // 渲染统计表格
        function renderStatisticsTable(statistics) {
            const tbody = document.getElementById('statisticsTableBody');
            tbody.innerHTML = '';

            if (statistics.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; color: #666;">暂无统计数据</td></tr>';
                return;
            }

            statistics.forEach(stat => {
                const row = document.createElement('tr');
                
                // 处理Oracle数据库返回的大写字段名
                const staffName = stat.STAFFNAME || stat.staffName || '未知员工';
                const departmentName = stat.DEPARTMENTNAME || stat.departmentName || '未知部门';
                const totalDays = stat.TOTALDAYS || stat.totalDays || 0;
                const normalDays = stat.NORMALDAYS || stat.normalDays || 0;
                const lateDays = stat.LATEDAYS || stat.lateDays || 0;
                const earlyLeaveDays = stat.EARLYLEAVEDAYS || stat.earlyLeaveDays || 0;
                const absentDays = stat.ABSENTDAYS || stat.absentDays || 0;
                const totalWorkHours = stat.TOTALWORKHOURS || stat.totalWorkHours || 0;
                const avgWorkHours = stat.AVGWORKHOURS || stat.avgWorkHours || 0;
                const attendanceRate = stat.ATTENDANCERATE || stat.attendanceRate || 0;
                
                // 计算出勤率样式
                let attendanceRateClass = 'attendance-rate ';
                if (attendanceRate >= 95) {
                    attendanceRateClass += 'excellent';
                } else if (attendanceRate >= 85) {
                    attendanceRateClass += 'good';
                } else {
                    attendanceRateClass += 'poor';
                }
                
                row.innerHTML = `
                    <td>${staffName}</td>
                    <td>${departmentName}</td>
                    <td>${totalDays}</td>
                    <td><span class="status-badge status-success">${normalDays}</span></td>
                    <td><span class="status-badge status-warning">${lateDays}</span></td>
                    <td><span class="status-badge status-orange">${earlyLeaveDays}</span></td>
                    <td><span class="status-badge status-danger">${absentDays}</span></td>
                    <td>${parseFloat(totalWorkHours).toFixed(1)}h</td>
                    <td>${parseFloat(avgWorkHours).toFixed(1)}h</td>
                    <td><span class="${attendanceRateClass}">${parseFloat(attendanceRate).toFixed(1)}%</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // 重置考勤筛选条件
        function resetAttendanceFilter() {
            document.getElementById('attendanceStaffFilter').value = '';
            document.getElementById('attendanceDateStart').value = '';
            document.getElementById('attendanceDateEnd').value = '';
            loadAttendanceRecords();
        }

        // 设置默认日期（最近30天）
        function setDefaultDates() {
            const today = new Date();
            const thirtyDaysAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
            
            document.getElementById('attendanceDateStart').value = thirtyDaysAgo.toISOString().split('T')[0];
            document.getElementById('attendanceDateEnd').value = today.toISOString().split('T')[0];
            
            document.getElementById('statsStartDate').value = thirtyDaysAgo.toISOString().split('T')[0];
            document.getElementById('statsEndDate').value = today.toISOString().split('T')[0];
        }
    </script>

    <style>
        /* Tab导航样式 */
        .tab-navigation {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }

        .tab-btn {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #6c757d;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .tab-btn:hover {
            color: #495057;
            background-color: #f8f9fa;
        }

        .tab-btn.active {
            color: #007bff;
            border-bottom-color: #007bff;
            background-color: #f8f9fa;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* 考勤状态样式 */
        .status-badge.status-success {
            background-color: #28a745;
            color: white;
        }

        .status-badge.status-warning {
            background-color: #ffc107;
            color: #212529;
        }

        .status-badge.status-orange {
            background-color: #fd7e14;
            color: white;
        }

        .status-badge.status-danger {
            background-color: #dc3545;
            color: white;
        }

        .status-badge.status-secondary {
            background-color: #6c757d;
            color: white;
        }

        /* 出勤率样式 */
        .attendance-rate.excellent {
            color: #28a745;
            font-weight: bold;
        }

        .attendance-rate.good {
            color: #ffc107;
            font-weight: bold;
        }

        .attendance-rate.poor {
            color: #dc3545;
            font-weight: bold;
        }

        /* 当前时间显示 */
        .current-time {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            color: #495057;
            border: 1px solid #dee2e6;
        }

        .current-time i {
            color: #007bff;
            margin-right: 5px;
        }

        /* 统计卡片优化 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
            border: 1px solid #e9ecef;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .tab-navigation {
                flex-wrap: wrap;
            }
            
            .tab-btn {
                padding: 8px 16px;
                font-size: 13px;
                margin-bottom: 5px;
            }
            
            .search-filters {
                flex-direction: column;
            }
            
            .search-filters .form-group {
                margin-bottom: 1rem;
            }
        }
    </style>
</body>
</html>
