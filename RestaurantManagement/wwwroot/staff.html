<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>员工管理 - 餐饮管理系统</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- ...existing code... -->

    <!-- 添加/编辑员工模态框 -->
    <div id="addStaffModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="staffModalTitle">添加员工</h3>
                <span class="close">&times;</span>
            </div>
            <form id="staffForm">
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="staffName">员工姓名:</label>
                            <input type="text" id="staffName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="staffPosition">职位:</label>
                            <select id="staffPosition" class="form-control" required>
                                <option value="">请选择职位</option>
                                <option value="服务员">服务员</option>
                                <option value="厨师">厨师</option>
                                <option value="收银员">收银员</option>
                                <option value="经理">经理</option>
                                <option value="清洁员">清洁员</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="staffPhone">联系电话:</label>
                            <input type="tel" id="staffPhone" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="staffSalary">薪资(元/月):</label>
                            <input type="number" id="staffSalary" class="form-control" min="0" step="100" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="staffDepartment">所属部门:</label>
                            <select id="staffDepartment" class="form-control" required>
                                <option value="">请选择部门</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="staffStore">所属门店:</label>
                            <select id="staffStore" class="form-control" required>
                                <option value="">请选择门店</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="workSchedule">工作安排:</label>
                        <textarea id="workSchedule" class="form-control" rows="3" placeholder="如：周一至周五 9:00-18:00"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="Utils.hideModal('addStaffModal')" class="btn btn-secondary">取消</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ...existing code... -->

    <script src="js/common.js"></script>
    <script src="js/auth.js"></script>
    <script>
        let allStaff = [];
        let filteredStaff = [];
        let attendanceRecords = [];
        let currentStaffId = null;
        let allDepartments = [];
        let allStores = [];

        document.addEventListener('DOMContentLoaded', function() {
            loadStaff();
            loadDepartmentsAndStores();
            setupEventListeners();
            setDefaultDates();
        });

        async function loadDepartmentsAndStores() {
            try {
                allDepartments = await API.get('/departments');
                allStores = await API.get('/stores');
                const deptSelect = document.getElementById('staffDepartment');
                const storeSelect = document.getElementById('staffStore');
                deptSelect.innerHTML = '<option value="">请选择部门</option>';
                storeSelect.innerHTML = '<option value="">请选择门店</option>';
                allDepartments.forEach(d => {
                    const opt = document.createElement('option');
                    opt.value = d.departmentID || d.departmentId || d.id;
                    opt.textContent = d.departmentName || d.name;
                    deptSelect.appendChild(opt);
                });
                allStores.forEach(s => {
                    const opt = document.createElement('option');
                    opt.value = s.storeID || s.storeId || s.id;
                    opt.textContent = s.storeName || s.name;
                    storeSelect.appendChild(opt);
                });
            } catch (e) {
                Utils.showNotification('加载部门或门店失败', 'error');
            }
        }

        function setupEventListeners() {
            document.getElementById('staffForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleStaffSubmit();
            });
        }

        // ...existing code...

        async function handleStaffSubmit() {
            if (!Utils.validateForm(document.getElementById('staffForm'))) {
                Utils.showNotification('请填写完整信息', 'warning');
                return;
            }

            try {
                const staffData = {
                    staffName: document.getElementById('staffName').value,
                    position: document.getElementById('staffPosition').value,
                    phone: document.getElementById('staffPhone').value,
                    salary: parseFloat(document.getElementById('staffSalary').value),
                    workSchedule: document.getElementById('workSchedule').value || null,
                    departmentID: parseInt(document.getElementById('staffDepartment').value),
                    storeID: parseInt(document.getElementById('staffStore').value)
                };

                if (!staffData.departmentID || !staffData.storeID) {
                    Utils.showNotification('请选择部门和门店', 'warning');
                    return;
                }

                if (currentStaffId) {
                    staffData.staffID = currentStaffId;
                    await API.put(`/staff/${currentStaffId}`, staffData);
                    Utils.showNotification('员工信息更新成功', 'success');
                } else {
                    await API.post('/staff', staffData);
                    Utils.showNotification('员工添加成功', 'success');
                }

                Utils.hideModal('addStaffModal');
                await loadStaff();

            } catch (error) {
                console.error('保存员工信息失败:', error);
                Utils.showNotification('保存员工信息失败', 'error');
            }
        }

        function editStaff(staffId) {
            const staff = allStaff.find(s => s.staffID === staffId);
            if (!staff) return;

            currentStaffId = staffId;
            document.getElementById('staffModalTitle').textContent = '编辑员工信息';
            document.getElementById('staffName').value = staff.staffName;
            document.getElementById('staffPosition').value = staff.position;
            document.getElementById('staffPhone').value = staff.phone;
            document.getElementById('staffSalary').value = staff.salary;
            document.getElementById('workSchedule').value = staff.workSchedule || '';
            document.getElementById('staffDepartment').value = staff.departmentID;
            document.getElementById('staffStore').value = staff.storeID;

            Utils.showModal('addStaffModal');
        }

        // ...existing code...
    </script>
</body>
</html>